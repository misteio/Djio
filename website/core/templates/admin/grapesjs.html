{% load staticfiles %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Editor HTML</title>
        <link rel="stylesheet" href="{% static 'css/admin/toastr.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/admin/grapesjs/grapes.css' %}">
        <link rel="stylesheet" href="{% static 'css/admin/grapesjs/grapesjs-preset-webpage.css' %}">
        <link rel="stylesheet" href="{% static 'css/admin/grapesjs/tooltip.css' %}">
        <link rel="stylesheet" href="{% static 'css/admin/grapesjs/perfect-scrollbar.css' %}">
        <link rel="stylesheet" href="{% static 'css/admin/grapesjs/grapesjs-plugin-filestack.css' %}">
        <!-- Bootstrap and Font Awesome css -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <!-- Css animations  -->
        <link href="{% static 'css/front/animate.css' %}" rel="stylesheet">
        <!-- Theme stylesheet, if possible do not edit this stylesheet -->
        <link href="{% static 'css/front/style.default.css' %}" rel="stylesheet" id="theme-stylesheet">
        <!-- Custom stylesheet - for your changes -->
        <link href="{% static 'css/front/custom.css' %}" rel="stylesheet">
        <script src="{% static 'js/admin/grapesjs/editor.js' %}"></script>

        <script src="{% static 'js/admin/grapesjs/filestack.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/perfect-scrollbar.min.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/toastr.min.js' %}"></script>
        <script src="{% static 'js/admin/ckeditor/ckeditor.js' %}"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/grapesjs/0.12.37/grapes.min.js"></script>
        <script src="{% static 'js/admin/grapesjs/grapesjs-plugin-export.min.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/grapesjs-plugin-filestack.min.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/grapesjs-blocks-basic.min.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/grapesjs-preset-webpage.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/grapesjs-plugin-forms.min.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/grapesjs-aviary.min.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/grapesjs-navbar.min.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/grapesjs-component-countdown.min.js' %}"></script>
        <script src="{% static 'js/admin/grapesjs/grapejs-ckeditor.js' %}"></script>


        <style type="text/css">
            body, html{
            height: 100%;
            margin: 0;
            overflow: hidden;
            }
            iframe {
            user-select: none;
            -webkit-user-select: none;
            }
            #wte-pn-options2.wte-pn-panel{box-shadow: none;}
            .icon-add-comp::before, .icon-comp100::before,.icon-comp50::before,.icon-comp30::before,.icon-rm::before{ content: '';}
            .icon-add-comp {
            background: url("./img/icon-sq-a.png") no-repeat center;
            }
            .icon-comp100 {
            background: url("./img/icon-sq-1.png") no-repeat center;
            }
            .icon-comp50 {
            background: url("./img/icon-sq-2.png") no-repeat center;
            }
            .icon-comp30 {
            background: url("./img/icon-sq-3.png") no-repeat center;
            }
            .icon-rm {
            background: url("./img/icon-sq-r.png") no-repeat center;
            }
            .icons-flex {
            background-size: 70% 65% !important;
            height: 15px;
            width: 17px;
            opacity: 0.9;
            }
            .icon-dir-row {
            background: url("./img/flex-dir-row.png") no-repeat center;
            }
            .icon-dir-row-rev {
            background: url("./img/flex-dir-row-rev.png") no-repeat center;
            }
            .icon-dir-col {
            background: url("./img/flex-dir-col.png") no-repeat center;
            }
            .icon-dir-col-rev {
            background: url("./img/flex-dir-col-rev.png") no-repeat center;
            }
            .icon-just-start{
            background: url("./img/flex-just-start.png") no-repeat center;
            }
            .icon-just-end{
            background: url("./img/flex-just-end.png") no-repeat center;
            }
            .icon-just-sp-bet{
            background: url("./img/flex-just-sp-bet.png") no-repeat center;
            }
            .icon-just-sp-ar{
            background: url("./img/flex-just-sp-ar.png") no-repeat center;
            }
            .icon-just-sp-cent{
            background: url("./img/flex-just-sp-cent.png") no-repeat center;
            }
            .icon-al-start{
            background: url("./img/flex-al-start.png") no-repeat center;
            }
            .icon-al-end{
            background: url("./img/flex-al-end.png") no-repeat center;
            }
            .icon-al-str{
            background: url("./img/flex-al-str.png") no-repeat center;
            }
            .icon-al-center{
            background: url("./img/flex-al-center.png") no-repeat center;
            }
            #wte-sm-label-parent-flex {
            width: 100%;
            }
            #wte-sm-label-parent-flex .wte-sm-field{display: none;}
            #wte-sm-label-parent-flex {
            border-bottom: 1px solid #383838;
            font-size: 12px;
            padding: 15px 3px 5px;
            width: 100%;
            }
            #wte-sm-flex-grow, #wte-sm-flex-shrink{ width:30%;}
            #wte-sm-flex-basis{ width:40%;}
            #toast-container {
            font-size: 13px;
            font-weight: lighter;
            }
            #toast-container > div,
            #toast-container > div:hover {
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
            font-family: Helvetica, sans-serif;
            }
            #toast-container > div {
            opacity: 0.95;
            }
            #gjs-pn-devices-c {
            width: 85%;
            z-index: 1;
            }
            #gjs-sm-float,
            #gjs-pn-views .fa-cog,
            #gjs-pn-commands .gjs-pn-buttons {
            display: none;
            }
            .gjs-pn-panel#gjs-pn-commands {
            width: 200px;
            box-shadow: none;
            }
            [data-tooltip]::after {
            background: rgba(51, 51, 51, 0.9);
            }
            .gjs-am-preview-cont {
            height: 100px;
            width: 100%;
            }
            .gjs-logo {
            height: 25px;
            }
            .gjs-logo-cont {
            position: absolute;
            left: 25px;
            top: 8px;
            }
            .gjs-logo-version {
            position: absolute;
            background-color: #756467;
            font-size: 10px;
            padding: 1px 7px;
            border-radius: 15px;
            bottom: 2px;
            right: -43px;
            }
        </style>
    </head>
    <body>
        <div id="modal-file" class="modais" data-izimodal-title="Select a file" data-izimodal-iframeURL="/admin/roxyfileman/?integration=custom&type=files&txtFieldId=image_input"></div>

        <div id="gjs" style="height:0px; overflow:hidden">
        </div>
        <script type="text/javascript">
            var editor = grapesjs.init({
                    canvas: {
                        styles: ['{{ config.WEBSITE_MEDIA_URL }}{{ config.CSS_FRONT_COMPRESSED }}'],
                        scripts: ['{{ config.WEBSITE_MEDIA_URL }}{{ config.JS_FRONT_COMPRESSED }}']
                    },

                    components: window.parent.document.getElementById('body') ? window.parent.document.getElementById('body').value : '',
                    style: '.txt-red{color: red}',
                    height: '100%',
                    container: '#gjs',
                    showOffsets: 1,
                    plugins: [
                        'gjs-plugin-export', 'gjs-plugin-filestack',
                        'gjs-aviary', 'gjs-blocks-basic', 'gjs-preset-webpage',
                        'gjs-navbar', 'gjs-component-countdown', 'gjs-plugin-forms', 'gjs-plugin-ckeditor'
                    ],
                    pluginsOpts: {
                        'gjs-plugin-filestack': {
                            key: 'AYmqZc2e8RLGLE7TGkX3Hz',
                        },
                        'gjs-plugin-ckeditor': {
                            options: {
                                filebrowserImageUploadUrl: '/admin/ckupload/',
                                language: 'fr',
                                customConfig: '{% static "js/admin/ckeditor/ckeditor_config.js" %}',
                            }
                        }
                    },

                    storageManager: {
                        storeComponents: 0,
                        storeStyles: 0,
                        autosave: false,
                        autoload: 0
                    },

                    // Configure style
                    styleManager: {
                        sectors: [{
                            name: 'General',
                            buildProps: ['float', 'display', 'position', 'top', 'right', 'left', 'bottom'],
                            properties: [{
                                name: 'Alignment',
                                property: 'float',
                                type: 'radio',
                                defaults: 'none',
                                list: [
                                    {value: 'none', className: 'fa fa-times'},
                                    {value: 'left', className: 'fa fa-align-left'},
                                    {value: 'right', className: 'fa fa-align-right'}
                                ],
                            },
                                {property: 'position', type: 'select'}
                            ],
                        }, {
                            name: 'Dimension',
                            open: false,
                            buildProps: ['width', 'height', 'max-width', 'min-height', 'margin', 'padding'],
                            properties: [{
                                property: 'margin',
                                properties: [
                                    {name: 'Top', property: 'margin-top'},
                                    {name: 'Right', property: 'margin-right'},
                                    {name: 'Bottom', property: 'margin-bottom'},
                                    {name: 'Left', property: 'margin-left'}
                                ],
                            }, {
                                property: 'padding',
                                properties: [
                                    {name: 'Top', property: 'padding-top'},
                                    {name: 'Right', property: 'padding-right'},
                                    {name: 'Bottom', property: 'padding-bottom'},
                                    {name: 'Left', property: 'padding-left'}
                                ],
                            }],
                        }, {
                            name: 'Decorations',
                            open: false,
                            buildProps: ['opacity', 'background-color', 'border-radius', 'border', 'box-shadow', 'background'],
                            properties: [{
                                type: 'slider',
                                property: 'opacity',
                                defaults: 1,
                                step: 0.01,
                                max: 1,
                                min: 0,
                            }, {
                                property: 'border-radius',
                                properties: [
                                    {name: 'Top', property: 'border-top-left-radius'},
                                    {name: 'Right', property: 'border-top-right-radius'},
                                    {name: 'Bottom', property: 'border-bottom-left-radius'},
                                    {name: 'Left', property: 'border-bottom-right-radius'}
                                ],
                            }, {
                                property: 'box-shadow',
                                properties: [
                                    {name: 'X position', property: 'box-shadow-h'},
                                    {name: 'Y position', property: 'box-shadow-v'},
                                    {name: 'Blur', property: 'box-shadow-blur'},
                                    {name: 'Spread', property: 'box-shadow-spread'},
                                    {name: 'Color', property: 'box-shadow-color'},
                                    {name: 'Shadow type', property: 'box-shadow-type'}
                                ],
                            }, {
                                property: 'background',
                                properties: [
                                    {name: 'Image', property: 'background-image'},
                                    {name: 'Repeat', property: 'background-repeat'},
                                    {name: 'Position', property: 'background-position'},
                                    {name: 'Attachment', property: 'background-attachment'},
                                    {name: 'Size', property: 'background-size'}
                                ],
                            },],
                        },
                        ],
                    },
                }
            );

            var cmdm = editor.Commands;
            cmdm.add('open-github', {
                run: function (em, sender) {
                    sender.set('active', false);
                    window.open('https://github.com/artf/grapesjs', '_blank');
                },
            });

            window.editor = editor;


            // Simple warn notifier
            var origWarn = console.warn;
            toastr.options = {
                closeButton: true,
                preventDuplicates: true,
                showDuration: 250,
                hideDuration: 150
            };
            console.warn = function (msg) {
                if (msg.indexOf('[undefined]') == -1) {
                    toastr.warning(msg);
                }
                origWarn(msg);
            };


            // Beautify tooltips
            var titles = document.querySelectorAll('*[title]');
            for (var i = 0; i < titles.length; i++) {
                var el = titles[i];
                var title = el.getAttribute('title');
                title = title ? title.trim() : '';
                if (!title)
                    break;
                el.setAttribute('data-tooltip', title);
                el.setAttribute('title', '');
            }

            // Store and load events
            editor.on('storage:load', function (e) {
                console.log('Loaded ', e);
                console.log('run command')
                console.log(editor.runCommand('gjs-get-inlined-html'));
            });
            editor.on('storage:store', function (e) {
                console.log('Stored ', e);
            });
            editor.on('load', function () {
            });


            var pnm = editor.Panels;
            pnm.addButton('options', [{
                id: 'save-html',
                className: 'fa fa-floppy-o',
                command: 'save-html',
                attributes: {title: 'Save'}
            }])

            cmdm.add('save-html', {
                run: function (em, sender) {
                    sender && sender.set('active', 0); // turn off the button
                    editor.store();
                    var s = window.parent.document.getElementById('body');
                    s.value = editor.getHtml();
                    window.parent.renderHtml();
                },
            });

            cmdm.add('open-assets', {
                run: function (em, sender, opts) {
                    const modal = editor.Modal;
                    const title = "{% trans 'select file' %}";

                    current_target = {simple_image: opts.target}
                    modal.setTitle(title);
                    modal.setContent('<iframe width="100%" height="500px" src="/admin/roxyfileman/?integration=custom&type=images&txtFieldId=image_input"> </iframe>');
                    modal.open();
                },
            });

            var current_target = {};
            function selectFileAndClose(path) {
                if (current_target.simple_image) {
                    current_target.simple_image.set('src', '/media/' + path)
                    //current_target.simple_image.collection.parent.view.$el[0].href = '/media/' + path
                    current_target.simple_image.collection.parent.set({href: '/media/' + path})
                    console.log(current_target.simple_image.collection.parent)
                }
                editor.Modal.close()
            }


        </script>
    </body>
</html>